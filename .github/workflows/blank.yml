name: Build HandBrakeCLI
on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          repository: HandBrake/HandBrake
      
      - name: Install deps
        run: |
          sudo apt-get update
          sudo apt-get install -y autoconf automake build-essential \
            cmake git libass-dev libbz2-dev libfontconfig-dev \
            libfreetype-dev libfribidi-dev libharfbuzz-dev \
            libjansson-dev liblzma-dev libmp3lame-dev libnuma-dev \
            libogg-dev libopus-dev libsamplerate-dev libspeex-dev \
            libtheora-dev libtool libvorbis-dev libx264-dev \
            libxml2-dev meson nasm ninja-build patch python3 zlib1g-dev
      
      - name: Build
        run: ./configure --launch-jobs=$(nproc) --disable-gtk --enable-static --launch
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: HandBrakeCLI
          path: build/HandBrakeCLI
